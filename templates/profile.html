<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
    color: #333;
  }
  .back-link {
    display: inline-block;
    margin: 20px 40px 0 40px;
    font-size: 1rem;
    color: #4a90e2;
    text-decoration: none;
    font-weight: 600;
  }
  .back-link:hover {
    text-decoration: underline;
  }
  .card {
    max-width: 950px;
    background: white;
    margin: 20px auto 40px auto;
    padding: 30px 40px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    min-height: calc(100%);
  }
  h2, h3 {
    margin-top: 0;
    color: #2c3e50;
  }
  p {
    font-size: 1rem;
    margin: 6px 0;
  }
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 8px;
    margin-top: 20px;
  }
  th, td {
    text-align: left;
    padding: 12px 15px;
  }
  th {
    background-color: #4a90e2;
    color: white;
    font-weight: 600;
    border-radius: 8px 8px 0 0;
  }
  tr {
    background: #f9fbfd;
    border-radius: 8px;
  }
  tr td:first-child {
    border-radius: 8px 0 0 8px;
  }
  tr td:last-child {
    border-radius: 0 8px 8px 0;
  }
</style>

<a href="/home" class="back-link">&larr; Back</a>

<div class="card">
  <h2>Patient Profile</h2>

  <p><strong>Name:</strong> {{ user.first_name }} {{ user.second_name }}</p>
  <p><strong>Age:</strong> {{ user.age }}</p>
  <p><strong>Alcoholic:</strong> {{ user.alcoholic }}</p>
  <p><strong>Diabetic:</strong> {{ user.diabetic }}</p>
  <p><strong>Height:</strong> {{ user.height }} cm</p>
  <p><strong>Weight:</strong> {{ user.weight }} kg</p>

  <h3>Heart Risk Predictions</h3>
  <table id="predictions-table">
      <tr>
          <th>Date</th>
          <th>Chest Pain Type</th>
          <th>Resting BP</th>
          <th>Cholesterol</th>
          <th>Fasting Blood Sugar</th>
          <th>Resting ECG</th>
          <th>Max Heart Rate</th>
          <th>Exercise Induced Angina</th>
          <th>Prediction</th>
      </tr>
      {% for pred in predictions %}
      <tr>
          <td>{{ pred.created_at }}</td>
          <td>{{ pred.cp }}</td>
          <td>{{ pred.trestbps }}</td>
          <td>{{ pred.chol }}</td>
          <td>{{ pred.fbs }}</td>
          <td>{{ pred.restecg }}</td>
          <td>{{ pred.thalach }}</td>
          <td>{{ pred.exang }}</td>
          <td>{{ pred.result }}</td>
      </tr>
      {% endfor %}
  </table>
  <div style="text-align: center;">
    <button id="show-more-pred" style="margin-top:10px; display:none;">Show More</button>
  </div>

  <h3>Appointments Scheduled</h3>
  <table id="appointments-table">
      <tr>
          <th>Date</th>
          <th>Doctor</th>
      </tr>
      {% for appt in appointments %}
      <tr>
        <td>{{ appt.appointment_date }}</td>
        <td>{{ appt.first_name }} {{ appt.last_name }}</td>
      </tr>
      {% endfor %}
  </table>
  <div style="text-align: center;">
    <button id="show-more-appt" style="margin-top:10px; display:none;">Show More</button>
  </div>
</div>
</div>

<script>
// Utility to show only first 5 rows (excluding header) for a table, and reveal on button click.
function setupShowMore(tableId, buttonId) {
  const table = document.getElementById(tableId);
  const button = document.getElementById(buttonId);
  if (!table || !button) return;
  // Get all rows except the header row
  const rows = Array.from(table.getElementsByTagName('tr')).slice(1);
  if (rows.length > 5) {
    // Hide all rows after the 5th
    for (let i = 5; i < rows.length; i++) {
      rows[i].style.display = 'none';
    }
    button.style.display = '';
    button.onclick = function() {
      for (let i = 5; i < rows.length; i++) {
        rows[i].style.display = '';
      }
      button.style.display = 'none';
    };
  }
}
window.addEventListener('DOMContentLoaded', function() {
  setupShowMore('predictions-table', 'show-more-pred');
  setupShowMore('appointments-table', 'show-more-appt');
});
</script>